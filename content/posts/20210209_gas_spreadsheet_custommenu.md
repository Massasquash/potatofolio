---
title: "[GAS]SpreadSheetにカスタムメニューを追加して簡単なUIを作る"
date: 2021-02-09
lead: "最終行へ移動する関数をカスタムメニューで実行できるようにする"
categories:
  - "GAS"
tags:
  - "業務効率化"
---

# はじめに
今回はGASでカスタムメニューを追加するスクリプトです。  

この実装をすると、画像のようにメニューバー（ツールバー）の一番右に「カスタムメニュー」という項目が新しく追加され、クリックしたときの処理をカスタマイズすることができます。  
<br>
![image](/img/posts/20210209_gas_spreadsheet_custommenu/%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88%202021-02-09%2023.15.06.png)

今回カスタムメニューを作って実装してみる内容は、Spreadsheetで「最終行へアクティブセルを移動する」というものです。  
普段僕は特定のPC作業をしたときのログをスプレッドシートを作っているのですが、行数が増えてくると一番下まで入力が面倒になります。クリックするだけで一番下に飛べると便利だなーと思って作ってみました。

それでは実装の仕方を見ていきましょう。

## 全体のスクリプト
Spreadsheetのコンテナバインドスクリプトを作り、以下のスクリプトを記述します。  
スプレッドシートをリロードすると、カスタムメニューが追加できます。  

```javascript
// 現在のスプレッドシート
const SS = SpreadsheetApp.getActiveSpreadsheet();

// ファイルが開いたときに動作する処理
function onOpen() {
  SS.addMenu('カスタムメニュー', [
    {name: '最新行へ', functionName: 'moveToLastRow_'}
  ]);
}

// 最終行にアクティブセルを移動する関数
function moveToLastRow_(){
  const sheet = SS.getActiveSheet();
  const lastRow = sheet.getLastRow();
  const lastRange = sheet.getRange(lastRow + 1, 1);
  SpreadsheetApp.setActiveRange(lastRange);
}
```

## 1. onOpen()関数を作る
まずは`onOpen()`という名前で、ファイルが開かれたときに動作する関数を作っておきます。  

```javascript
// 現在のスプレッドシート
const SS = SpreadsheetApp.getActiveSpreadsheet();

// ファイルが開いたときに動作する処理
function onOpen() {
	// [TODO] カスタムメニューを追加する処理
}
```

SpreadSheetオブジェクトの定義も最初にしておきましょう。のちの関数でもこのオブジェクトを使うため、グローバルスコープに記述しています。  

このように`onOpen()`という名前で関数を作ると、ファイルが開いたときに動作する処理を作ることができます。トリガーを設定する必要などありません。  
こういった特定のイベントが起こったときに処理を実行する関数を「イベントハンドラ」と呼ぶそうです。

## 2. メニューの選択肢を追加する
続いてカスタムメニューをクリックした時の選択肢を追加していきます。  
スプレッドシートオブジェクトの`addMenu()`メソッドを使い、以下のように記述します。  

```javascript
// ファイルが開いたときに動作する処理
function onOpen() {
	// カスタムメニューを追加する処理
  SS.addMenu('カスタムメニュー', [
    {name: '最新行へ', functionName: 'moveToLastRow_'}
  ]);
}
```

この`addMenu()`の第一引数には、メニューバーに表示させる文字列を書きます。  
ここでは「カスタムメニュー」としておきましょう。  

第二引数には、追加したいメニューをオブジェクトの配列で書いてあげます。  
このオブジェクトに`name`と`functionName`というプロパティを持たせることで、メニューに表記する文字列と、選択されたときに実行する関数名を指定することができます。

```javascript
{name: '<メニューに表記する文字列>', functionName: '<関数名>'}
```

ここで指定する関数は後ほど作るので、現段階ではまだ作っていないけど実装予定の名前で大丈夫です。  
ここでは`moveToLastRow_`という関数名を指定しておきました。

注意点としては、関数名には丸かっこをつけずに書くことです。  
もし丸カッコをつけてしまうと、その関数が実行されて戻り値が`functionName`の値に設定されてしまうことになります。今回は関数名を文字列として指定したいので、丸かっこをつけないで文字列リテラルで書くのが正解になります。  

この`addMenu()`の第二引数に指定するオブジェクトを増やしていくことで、どんどんメニューを追加することもできます（後ほど備考として記載します）。


## 3. メニューを選択したときに動作する関数を作る
最後に、先ほど関数名に指定した`moveToLastRow_()`関数を次のように作ればOKです。

```javascript
// 最終行にアクティブセルを移動する関数
function moveToLastRow_(){
  const sheet = SS.getActiveSheet();
  const lastRow = sheet.getLastRow();
  const lastRange = sheet.getRange(lastRow + 1, 1);
  SpreadsheetApp.setActiveRange(lastRange);
}
```

<br>

**アクティブセルの移動先を指定したい場合**  
ここでは現在のシートの「最終行の次の行の１列目」にアクティブセルを移動させています。  
もし移動させるセルを変更したい場合は、上のコードの5行目のこの部分を変えてあげましょう。
```javascript
const lastRange = sheet.getRange(lastRow + 1, 1);
```

例えば、現在のシートの「最終行の３列目」などとしたい場合は、次のようにカスタマイズすればOKです。
```javascript
const lastRange = sheet.getRange(lastRow, 3);
```


以上で実装は完了です。  
スクリプトを保存して、スプレッドシートを開いているページをリロードして少し待つと、カスタムメニューが追加されているかと思います！

## 備考
**カスタムメニューの選択肢を増やしたい場合**  
`onOpen()`に書いた`SS.addMenu()`の中身のオブジェクトを増やしてみましょう。

```javascript
function onOpen() {
	// カスタムメニューを追加する処理
  SS.addMenu('カスタムメニュー', [
    {name: '最新行へ', functionName: 'moveToLastRow_'},
    {name: 'マスタ転記', functionName: 'copyFromMaster_'},
    {name: 'ほげほげ', functionName: 'hogehoge'}
  ]);
}
```

配列の要素としてオブジェクトを追加していく形になるので、注意してくださいね。  
構文エラー（SyntaxError）が出てしまう場合は、オブジェクトの書き方やカンマの有無など要チェックです！

**スプレッドシートを開いたときに最終行に移動させたい場合**  
今回はカスタムメニューを使って最終行へ移動するスクリプトを書きましたが、ファイルを開いたときにアクティブセルを移動させるやり方でも良いかもしれません。  
そうしたい場合は、`onOpen()`に直接今回の`moveToLastRow_()`の中身の処理を書いてあげればOKです。  
ただし、セル数にもよりますが起動が重くなってしまうかもしれないので、ご注意ください。


# おわりに
カスタムメニューは、スプレッドシートを使っていて「ボタンをクリックしたら一括で処理するようにしたい」というような場合にシンプルなUIを作ることができて、とても便利ですね。  
他にも、スプレッドシートの関数で転記できるような作業でも、GASのカスタムメニューを使って実装をすることでシートを軽くすることもできそうです。  

いろんな用途で使えるので、是非試してみてください。  

**その他の実装アイデア**  
- カスタムメニューを実行すると、マスターデータから必要な情報を探して一括で転記する
- シートでメール送信先リストを作り、カスタムメニューをクリックするとメールが一括送信されるようにする